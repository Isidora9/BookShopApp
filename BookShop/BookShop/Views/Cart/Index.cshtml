@model BookShop.Domain.Entities.Order

<h4>Shopping Cart</h4>
<hr></hr>

@if (Model.OrderItems.Count == 0)
{
    <p>Your cart is empty.</p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Title</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Total</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.OrderItems)
            {
                <tr>
                    <td>@item.Book.Title</td>
                    <td>@Html.DisplayFor(model => item.Book.Price)</td>
                    <td>
                        <form id="quantityForm_@item.OrderItemId" asp-action="UpdateQuantity" asp-controller="Cart" method="post">
                            <input type="hidden" name="itemId" value="@item.OrderItemId" />
                            <select name="quantity" class="quantity">
                                @for (int i = 1; i <= 10; i++)
                                {
                                    if (i == item.Quantity)
                                    {
                                        <option value="@i" selected="selected">@i</option>
                                    }
                                    else
                                    {
                                        <option value="@i">@i</option>
                                    }
                                }
                            </select>
                        </form>
                    </td>
                    <td>@((item.Quantity * item.Book.Price).ToString("$0.00"))</td>
                    <td>
                        <form asp-action="RemoveFromCart" method="post">
                            <input type="hidden" name="orderItemId" value="@item.OrderItemId" />
                            <button type="submit" class="btn btn-sm btn-outline-danger">Remove</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
        <tfoot>
        <td class="no-bottom"></td>
        <td class="no-bottom"></td>
        <td class="no-bottom">Total price:</td>
        <td class="no-bottom">
                @Html.DisplayFor(model => model.TotalPrice)
        </td>
        </tfoot>
    </table>
}
<div>
    <a asp-controller="Shop" class="btn btn-success" asp-action="Index">Back to Shop</a>
</div>

@* <a asp-action="OrderSuccess" class="btn btn-success @if (Model.OrderItems.Count == 0) {
 <text>disabled</text>
 }">Order</a> *@

<h4 class="mt-3">Delivery Address</h4><hr></hr>

<form class="row g-3 m-5">
  <div class="col-md-4">
    <label for="validationDefault01" class="form-label">First name</label>
    <input type="text" class="form-control" id="validationDefault01" value="Mark" required>
  </div>
  <div class="col-md-4">
    <label for="validationDefault02" class="form-label">Last name</label>
    <input type="text" class="form-control" id="validationDefault02" value="Otto" required>
  </div>
  <div class="col-md-4">
    <label for="validationDefaultUsername" class="form-label">Username</label>
    <div class="input-group">
      <span class="input-group-text" id="inputGroupPrepend2"></span>
      <input type="text" class="form-control" id="validationDefaultUsername"  aria-describedby="inputGroupPrepend2" required>
    </div>
  </div>
  <div class="col-md-6">
    <label for="validationDefault03" class="form-label">City</label>
    <input type="text" class="form-control" id="validationDefault03" required>
  </div>
  <div class="col-md-3">
    <label for="validationDefault04" class="form-label">State</label>
    <select class="form-select" id="validationDefault04" required>
      <option selected disabled value="">Choose...</option>
      <option>...</option>
    </select>
  </div>
  <div class="col-md-3">
    <label for="validationDefault05" class="form-label">Zip</label>
    <input type="text" class="form-control" id="validationDefault05" required>
  </div>
  <div class="col-12">
    <div class="form-check">
      <input class="form-check-input" type="checkbox" value="" id="invalidCheck2" required>
      <label class="form-check-label" for="invalidCheck2">
        Agree to terms and conditions
      </label>
    </div>
  </div>
  <div class="col-12">
    <button class="btn mx-auto btn-success @if (Model.OrderItems.Count == 0) {
     <text>disabled</text>}" type="submit" asp-action="OrderSuccess">Confirm order</button>
  </div>
</form>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<a href="/Cart/Index" class="position-relative text-dark text-decoration-none">
    <i class="fas fa-shopping-cart fa-lg"></i>
    @if (5 > 0)
    {
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
            @Model.OrderItems.Count
        </span>
    }
</a>
@* <span id="cartItemCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">@ViewBag.CartItemCount</span>
 *@


<style>
    .no-bottom {
        border-bottom: none
    }
</style>

@* @section scripts {
    <script>
        $(document).ready(function () {
            $('.quantity').on('change', function () {
                $('#quantityForm').submit();
            });
        });
    </script>
} *@


@section scripts {
    <script>
        $(document).ready(function () {
            $('.quantity').on('change', function () {
                var formId = $(this).closest('form').attr('id'); // Get the ID of the closest form
                $('#' + formId).submit(); // Submit the form with the corresponding ID
            });
        });
    </script>
    @if (TempData["ErrorMessage"] != null)
    {
        <script>
            alert("@TempData["ErrorMessage"]");
        </script>
    }
}
